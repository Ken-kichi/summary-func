# ã€å®Œå…¨ã‚¬ã‚¤ãƒ‰ã€‘AIè¦ç´„ã‚¢ãƒ—ãƒªã‚’ã‚¼ãƒ­ã‹ã‚‰Azureã«ãƒ‡ãƒ—ãƒ­ã‚¤
## åˆå¿ƒè€…ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å¿…è¦‹ï¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰CI/CDæ§‹ç¯‰ã¾ã§

---

## ã¯ã˜ã‚ã«

ä¼šç¤¾ã®ç™ºè¡¨ä¼šã§ç”ŸæˆAIã‚’ä½¿ã£ã¦AI/ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ç³»ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è§£èª¬ã™ã‚‹è¨˜äº‹ã‚’æ›¸ãæ–¹æ³•ã«ã¤ã„ã¦ä¼šç¤¾ã§ç™ºè¡¨ã—ãŸã¨ã“ã‚ã€ã€Œç”ŸæˆAIã‚’ä½¿ã†æµã‚Œã¯ã‚ã‹ã£ãŸãŒã€ãƒ„ãƒ¼ãƒ«ã®ä½¿ã„æ–¹ã‚„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®åŸºç¤çŸ¥è­˜ãªã©ã§ã¤ã¾ãšã„ã¦ã†ã¾ãè‡ªåˆ†ãŒè¡¨ç¾ã—ãŸã„è¨˜äº‹ãŒæ›¸ã‘ãªã„ã€ã¨ã„ã†å£°ã‚’ã„ãŸã ãã¾ã—ãŸã€‚
ãã“ã§ã€è§£èª¬ã—ãŸã„ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹ã‚’ãƒšãƒ¼ã‚¹ãƒˆã™ã‚‹ã ã‘ã§è§£èª¬è¨˜äº‹ãŒæ›¸ã‘ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ã‚Œã°ã©ã†ã‹ã¨æ€ã„ã€ã“ã®ã‚¬ã‚¤ãƒ‰ã‚’æ›¸ãå§‹ã‚ã¾ã—ãŸã€‚**è‡ªåˆ†ã§ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’é›†ã‚ã€è¦ç‚¹ã‚’AIã«æŠ½å‡ºã•ã›ã€Mermaidã§å›³è§£ã—ã€æœ€å¾Œã¯Azureã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹**â€”ãã‚“ãªä¸€é€£ã®æµã‚Œã‚’åˆå¿ƒè€…ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã‚‚è¸ç ´ã§ãã‚‹ã‚ˆã†ã«ä¸å¯§ã«åˆ†è§£ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€**Azure OpenAIã‚’ä½¿ã£ãŸæ–°èè¨˜äº‹è¦ç´„ã‚¢ãƒ—ãƒª**ã‚’ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰Azureã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã€å®Œå…¨ã«æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’ãŠä¼ãˆã—ã¾ã™ã€‚

- âœ… **å¯¾è±¡è€…**: åˆå¿ƒè€…ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã€Pythonã®åŸºæœ¬çŸ¥è­˜ãŒã‚ã‚‹æ–¹
- âœ… **æ‰€è¦æ™‚é–“**: ç´„2ã€œ3æ™‚é–“ï¼ˆç’°å¢ƒæ§‹ç¯‰ã‚’å«ã‚€ï¼‰
- âœ… **é›£æ˜“åº¦**: â˜…â˜…â˜…â˜†â˜†ï¼ˆä¸­ç´šï¼‰
- âœ… **æœ€çµ‚çš„ãªæˆæœ**: Azure App Serviceã§ãƒ›ã‚¹ãƒˆã•ã‚ŒãŸAIè¦ç´„ã‚¢ãƒ—ãƒª

ã“ã®ã‚¢ãƒ—ãƒªã«ã¯ä»¥ä¸‹ã®ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ï¼š

1. **Azure OpenAIï¼ˆgpt-5.1-chatï¼‰** ã«ã‚ˆã‚‹é«˜ç²¾åº¦ãªè¦ç´„ç”Ÿæˆ
2. **è‡ªå‹•å›³è§£ç”Ÿæˆ** - Mermaidã§è¨˜äº‹å†…å®¹ã‚’å¯è¦–åŒ–
3. **GitHub Actionsã«ã‚ˆã‚‹è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤** - pushã™ã‚‹ã ã‘ã§æœ¬ç•ªåæ˜ 
4. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªã‚¤ãƒ³ãƒ•ãƒ©** - åˆæœŸã‚³ã‚¹ãƒˆ0å††ã§å§‹ã‚ã‚‹

### ã“ã®è¨˜äº‹ã§åˆ°é”ã™ã‚‹ã‚´ãƒ¼ãƒ«

åˆå¿ƒè€…ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒè¿·å­ã«ãªã‚ŠãŒã¡ãªãƒã‚¤ãƒ³ãƒˆã‚’ã€ä»¥ä¸‹ã®3ãƒ•ã‚§ãƒ¼ã‚ºã«åˆ†ã‘ã¦è§£èª¬ã—ã¾ã™ã€‚

- **Phase 1: ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º** â€” Flaskã§APIã¨ç”»é¢ã‚’ä½œã‚Šã€Azure OpenAIã¨ç¹‹ã’ã‚‹
- **Phase 2: ã‚¯ãƒ©ã‚¦ãƒ‰æº–å‚™** â€” Azure App Serviceã¨Azure OpenAIã‚’å®‰å…¨ã«æ§‹æˆã™ã‚‹
- **Phase 3: è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤** â€” GitHub Actionsã§pushâ†’å³ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿç¾ã™ã‚‹

ãƒ•ã‚§ãƒ¼ã‚ºã”ã¨ã«ã€Œã‚„ã‚‹ã“ã¨ / æœŸå¾…ã™ã‚‹çµæœ / ã¤ã¾ãšããƒã‚¤ãƒ³ãƒˆã€ã‚’æ•´ç†ã—ã¦ã„ã‚‹ã®ã§ã€é€”ä¸­ã§æ­¢ã¾ã£ã¦ã‚‚ç†ç”±ã‚’ç‰¹å®šã—ã‚„ã™ããªã£ã¦ã„ã¾ã™ã€‚ã§ã¯ã€ä¸€ç·’ã«æ§‹ç¯‰ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼


## å‰ææ¡ä»¶ã®ç¢ºèª

ã“ã®ã‚¬ã‚¤ãƒ‰ã‚’é€²ã‚ã‚‹å‰ã«ã€ä»¥ä¸‹ãŒæƒã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼š

### å¿…é ˆç’°å¢ƒ

| é …ç›® | è¦ä»¶ | ç¢ºèªæ–¹æ³• |
|------|------|---------|
| **OS** | macOS / Linux / Windows | `uname -s` ã§OSç¢ºèª |
| **Python** | 3.10 ä»¥ä¸Š | `python3 --version` |
| **pip** | ï¼ˆå‚è€ƒï¼‰PythonåŒæ¢±ã€‚uvåˆ©ç”¨æ™‚ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆç”¨ | `pip --version` |
| **Git** | ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ | `git --version` |
| **Node.js** | 16 ä»¥ä¸Š | `node --version` |
| **npm** | æœ€æ–°ç‰ˆ | `npm --version` |
| **uv** | æœ€æ–°ç‰ˆ | `uv --version` |

> â„¹ï¸ Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ pip ã§ã¯ãªã uv ã§è¡Œã„ã¾ã™ï¼ˆpip ã¯Pythonã«åŒæ¢±ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä½¿ç”¨ã—ã¾ã›ã‚“ï¼‰ã€‚

### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

- âœ… **Azureã‚¢ã‚«ã‚¦ãƒ³ãƒˆ** - ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ï¼ˆÂ¥22,500ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆï¼‰ã§OK
- âœ… **GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆ** - ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ›ã‚¹ãƒˆç”¨
- âœ… **Azure OpenAIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹** - äº‹å‰ç”³ã—è¾¼ã¿ãŒå¿…è¦ãªå ´åˆã‚ã‚Š

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª

```bash
# å…¨ã¦ã‚’ä¸€åº¦ã«ç¢ºèªã™ã‚‹å ´åˆ
python3 --version && git --version && node --version && npm --version && uv --version
```

**å‡ºåŠ›ä¾‹ï¼š**
```
Python 3.10.4
git version 2.41.0
v18.17.1
9.6.7
uv 0.7.8 (0ddcc1905 2025-05-23)
```

---

## Step 1: é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1-1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æº–å‚™

ã¾ãšã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
# ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd ~/Desktop

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
~/Desktop $ mkdir news-summarizer
~/Desktop $ cd news-summarizer
~/Desktop/news-summarizer $ uv init
```

### 1-2. Pythonä»®æƒ³ç’°å¢ƒã®æ§‹ç¯‰

Pythonã®ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚

```bash
# ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ
uv venv

# ä»®æƒ³ç’°å¢ƒã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆï¼ˆmacOS/Linuxï¼‰
source .venv/bin/activate

# Windows ã®å ´åˆ
# .venv\Scripts\activate

# ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆç¢ºèªï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«(.venv)ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰OKï¼‰
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š**
```
(news-summarizer) ~/Desktop/news-summarizer $
```

### 1-3. Pythonã®å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯pipã§ã¯ãªã**uv**ã§ç®¡ç†ã—ã¾ã™ã€‚uvã¯pipäº’æ›ã®CLIã‚’æä¾›ã™ã‚‹ãŸã‚ã€åŒã˜æ„Ÿè¦šã§åˆ©ç”¨ã§ãã¾ã™ãŒã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚„ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”ŸæˆãŒé«˜é€Ÿã§ã™ã€‚

```bash
# uv ã‚’æœ€æ–°åŒ–ï¼ˆä»»æ„ï¼‰
uv self update

# requirements.txtã‚’ä½œæˆï¼ˆå¾Œã»ã©è©³ç´°ã«èª¬æ˜ï¼‰
~/Desktop/news-summarizer $ uv add Flask python-dotenv langchain langchain-openai openai requests

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
uv pip install -r requirements.txt
```

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèªï¼š**
```bash
uv pip list | grep -E "Flask|langchain|openai"
```

### 1-4. Node.jsãŠã‚ˆã³Mermaid CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

å›³è§£æ©Ÿèƒ½ã«å¿…è¦ãª Mermaid CLI ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
# Mermaid CLI ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g @mermaid-js/mermaid-cli

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
mmdc --version

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ä¾‹: mermaid-cli 10.6.1
```

**ãƒˆãƒ©ãƒ–ãƒ«:** `mmdc: command not found` ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆ
```bash
# npm ã® ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‘ã‚¹ã‚’ç¢ºèª
npm config get prefix

# å‡ºåŠ›ä¾‹: /usr/local/Cellar/node/18.18.0/libexec/npm
# ã“ã®å ´æ‰€ã« mmdc ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™
```

### 1-5. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’æ•´ãˆã‚‹

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿…è¦ãªãƒ•ã‚©ãƒ«ãƒ€ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
mkdir -p templates static .github/workflows

# åŸºæœ¬ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
touch main.py .env .gitignore
```

**ä½œæˆå¾Œã®æ§‹é€ ï¼š**
```
news-summarizer-p/
â”œâ”€â”€ .venv/                    # ä»®æƒ³ç’°å¢ƒï¼ˆè‡ªå‹•ä½œæˆï¼‰
â”œâ”€â”€ .github/workflows/        # GitHub Actionsè¨­å®š
â”œâ”€â”€ static/                   # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ main.js
â”‚   â””â”€â”€ styles.css
â”œâ”€â”€ templates/                # HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ main.py                   # Flask ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ requirements.txt          # Python ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”œâ”€â”€ .env                      # ç’°å¢ƒå¤‰æ•°ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç”¨ï¼‰
â””â”€â”€ .gitignore                # Gité™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ«
```

### 1-6. åˆå¿ƒè€…ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ

> ã“ã“ã¾ã§å®Œäº†ã—ãŸã‚‰ã€å¾Œå·¥ç¨‹ã«é€²ã‚€å‰ã«æ¬¡ã®ãƒã‚¤ãƒ³ãƒˆã‚’ç°¡å˜ã«ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚åˆå­¦è€…ãŒã¤ã¾ãšãã‚„ã™ã„å ´æ‰€ã‚’å…ˆå›ã‚Šã§æ½°ã—ã¦ãŠãã¨ã€Azureãƒ‡ãƒ—ãƒ­ã‚¤ã‚„CI/CDã¾ã§ä¸€æ°—ã«é§†ã‘æŠœã‘ã‚‰ã‚Œã¾ã™ã€‚

- **ä»®æƒ³ç’°å¢ƒãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹**: macOS/Linuxã¯ `source .venv/bin/activate`ã€PowerShellã¯ `.\.venv\Scripts\Activate.ps1`ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé ­ã« `(.venv)` ãŒå‡ºã¦ã„ã‚Œã°æˆåŠŸã§ã™ã€‚
- **uvã§ä¾å­˜é–¢ä¿‚ã‚’å…¥ã‚Œã¦ã„ã‚‹ã‹**: `uv pip list | head` ã‚’å®Ÿè¡Œã—ã€Flask ã‚„ langchain ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚`pip` ã‚³ãƒãƒ³ãƒ‰ã¯ä½¿ã‚ãªã„ã‚ˆã†æ³¨æ„ã€‚
- **requirements.txt / uv.lock ã‚’Gitç®¡ç†ã«å«ã‚ãŸã‹**: ä¾å­˜é–¢ä¿‚ã®å†ç¾æ€§ã‚’æ‹…ä¿ã™ã‚‹ãŸã‚ã€`git status --short | grep 'requirements.txt\|uv.lock'` ã§è¿½è·¡å¯¾è±¡ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚
- **.envãŒãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‹ã‚‰å¤–ã‚Œã¦ã„ã‚‹ã‹**: `git status --short | grep .env` ã§è¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã¯ `git rm --cached .env` ã‚’å®Ÿè¡Œã—ã€ç§˜å¯†æƒ…å ±ã®æ¼æ´©ã‚’é˜²ãã¾ã™ã€‚
- **Node.js / Mermaid CLI ã®ç¢ºèª**: `node --version` ã¨ `mmdc --version` ãŒé€šã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã€‚å¾ŒåŠã®å›³è§£ç”Ÿæˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§çªç„¶ã¤ã¾ãšãã®ã‚’é˜²ã’ã¾ã™ã€‚


## Step 2: Azureç’°å¢ƒã®æº–å‚™

ã“ã“ã‹ã‚‰ã¯Azure Portalã‚’ä½¿ç”¨ã—ã¦ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

> **äº‹å‰ãƒ¡ãƒ¢**: Azure ã®ãƒªã‚½ãƒ¼ã‚¹åã¯ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å†…ã¾ãŸã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ä¸€æ„ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`news-summarizer-app` ãŒæ—¢ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€GitHubãƒ¦ãƒ¼ã‚¶ãƒ¼åãªã©ã‚’ä»˜ã‘ã¦ `yourname-news-summarizer-app` ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã—ã‚‡ã†ã€‚ã¾ãŸã€ä»¥é™ã§ä½œæˆã™ã‚‹ã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã¯åŒã˜ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³/ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸ã‚“ã§æƒãˆã¦ãŠãã¨ã€æ–™é‡‘ã‚„ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚’é¿ã‘ã‚‰ã‚Œã¾ã™ã€‚ä½œæˆã—ãŸãƒªã‚½ãƒ¼ã‚¹åã¨ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¯ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒªã«æ§ãˆã¦ãŠãã®ãŒãŠã™ã™ã‚ã§ã™ã€‚

### 2-1. Azureã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™

1. [Azureå…¬å¼ã‚µã‚¤ãƒˆ](https://azure.microsoft.com/ja-jp/)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. **ç„¡æ–™ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ**ã‚’ã‚¯ãƒªãƒƒã‚¯
3. Microsoft ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆGmailãªã©ã§ã‚‚å¯ï¼‰
4. Â¥22,500ã®ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãŒä»˜ä¸ã•ã‚Œã¾ã™ï¼ˆ3ãƒ¶æœˆæœ‰åŠ¹ï¼‰

### 2-2. Azure Portalã§ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ

**ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—**ã¯ã€é–¢é€£ã™ã‚‹Azureãƒªã‚½ãƒ¼ã‚¹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®è«–ç†çš„ãªå˜ä½ã§ã™ã€‚

**æ‰‹é †ï¼š**

1. [Azure Portal](https://portal.azure.com/)ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³
2. å·¦ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰**ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—**ã‚’é¸æŠ
3. **ä½œæˆ**ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ä»¥ä¸‹ã‚’å…¥åŠ›ï¼š
   - **ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å**: `news-summarizer-rg`
   - **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: `æ±æ—¥æœ¬ï¼ˆTokyoï¼‰`ã¾ãŸã¯`æ—¥æœ¬æ±éƒ¨`ã‚’é¸æŠ
5. **ç¢ºèªãŠã‚ˆã³ä½œæˆ**â†’**ä½œæˆ**ã‚’ã‚¯ãƒªãƒƒã‚¯

### 2-3. App Service ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆ

App Service ãƒ—ãƒ©ãƒ³ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ›ã‚¹ãƒˆã™ã‚‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒªã‚½ãƒ¼ã‚¹ã®å®šç¾©ã§ã™ã€‚

**æ‰‹é †ï¼š**

1. Azure Portalã§**App Service ãƒ—ãƒ©ãƒ³**ã‚’æ¤œç´¢
2. **ä½œæˆ**ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ä»¥ä¸‹ã‚’å…¥åŠ›ï¼š
   - **ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—**: `news-summarizer-rg`ï¼ˆå…ˆã»ã©ä½œæˆã—ãŸã‚‚ã®ï¼‰
   - **åå‰**: `news-summarizer-plan`
   - **ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ **: `Linux`ã‚’é¸æŠ
   - **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: `æ±æ—¥æœ¬ï¼ˆTokyoï¼‰`
   - **ä¾¡æ ¼ãƒ¬ãƒ™ãƒ«**: `Free F1` â† **é‡è¦ï¼ç„¡æ–™æ ã§ã™**

4. **ç¢ºèªãŠã‚ˆã³ä½œæˆ**â†’**ä½œæˆ**ã‚’ã‚¯ãƒªãƒƒã‚¯

| ä¾¡æ ¼ãƒ¬ãƒ™ãƒ« | æœˆé¡ | ç”¨é€” |
|-----------|-----|------|
| **Free (F1)** | Â¥0 | é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰ |
| Basic (B1) | Â¥ç´„1,400 | å°è¦æ¨¡æœ¬ç•ª |
| Standard (S1) | Â¥ç´„3,800 | ä¸­è¦æ¨¡æœ¬ç•ª |

### 2-4. App Serviceï¼ˆã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªï¼‰ã‚’ä½œæˆ

æœ€å¾Œã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“ã‚’ãƒ›ã‚¹ãƒˆã™ã‚‹App Serviceã‚’ä½œæˆã—ã¾ã™ã€‚

**æ‰‹é †ï¼š**

1. Azure Portalã§**App Service**ã‚’æ¤œç´¢
2. **ä½œæˆ** â†’ **Web ã‚¢ãƒ—ãƒª**ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ä»¥ä¸‹ã‚’å…¥åŠ›ï¼š
   - **ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—**: `news-summarizer-rg`
   - **åå‰**: `news-summarizer-app`
     ï¼ˆä¾‹: `news-summarizer-app`ï¼‰
     â€»åå‰ã¯å…¨Azureå†…ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
   - **å…¬é–‹**: `ã‚³ãƒ¼ãƒ‰`ã‚’é¸æŠ
   - **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒƒã‚¯**: `Python 3.11`ã‚’é¸æŠ
   - **ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ **: `Linux`
   - **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: `æ±æ—¥æœ¬ï¼ˆTokyoï¼‰`
   - **App Service ãƒ—ãƒ©ãƒ³**: `news-summarizer-plan`

4. **ç¢ºèªãŠã‚ˆã³ä½œæˆ**â†’**ä½œæˆ**ã‚’ã‚¯ãƒªãƒƒã‚¯

### 2-5. Azure OpenAIã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

AIè¦ç´„æ©Ÿèƒ½ã«å¿…è¦ãª Azure OpenAI ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

**æ‰‹é †ï¼š**

1. Azure Portalã§**Azure OpenAI**ã‚’æ¤œç´¢
2. **ä½œæˆ**ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ä»¥ä¸‹ã‚’å…¥åŠ›ï¼š
   - **ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—**: `news-summarizer-rg`
   - **åå‰**: `news-summarizer-openai`
   - **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: `East US`ï¼ˆé‡è¦ï¼gpt-5.1-chatã¯é™å®šãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã¿å¯¾å¿œï¼‰
   - **ä¾¡æ ¼ãƒ¬ãƒ™ãƒ«**: `Standard S0`

4. **ç¢ºèªãŠã‚ˆã³ä½œæˆ**â†’**ä½œæˆ**ã‚’ã‚¯ãƒªãƒƒã‚¯

**âš ï¸ é‡è¦ãªæ³¨æ„ï¼š**

- Azure OpenAIã¯**äº‹å‰ç”³ã—è¾¼ã¿ãŒå¿…è¦**ãªå ´åˆãŒã‚ã‚Šã¾ã™
- æ—¢å­˜ã®Azureã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ååˆ†ãªã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãŒã‚ã‚Œã°åˆ©ç”¨å¯èƒ½
- ä½œæˆã«**æ•°åˆ†ã€œæ•°æ™‚é–“**ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™

### 2-6. Azure OpenAIã«ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

OpenAIãƒªã‚½ãƒ¼ã‚¹ä½œæˆå¾Œã€gpt-5.1-chatãƒ¢ãƒ‡ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

**æ‰‹é †ï¼š**

1. ä½œæˆã—ãŸã€Œnews-summarizer-openaiã€ãƒªã‚½ãƒ¼ã‚¹ã‚’é–‹ã
2. å·¦ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰**Model deployments** â†’ **Manage Deployments**ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **Create new deployment**ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ä»¥ä¸‹ã‚’å…¥åŠ›ï¼š
   - **Model**: `gpt-5.1-chat`ï¼ˆã¾ãŸã¯ã”åˆ©ç”¨å¯èƒ½ãªæœ€æ–°ãƒ¢ãƒ‡ãƒ«ï¼‰
   - **Model version**: `æœ€æ–°`ã‚’è‡ªå‹•é¸æŠ
   - **Deployment name**: `gpt-5.1-chat`
   - **Tokens per Minute Rate Limit (TPM)**: `80000`

5. **Create**ã‚’ã‚¯ãƒªãƒƒã‚¯

**ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œï¼š**

- **Endpoint**ï¼ˆä¾‹: `https://news-summarizer-openai.openai.azure.com/`ï¼‰
- **API Key**ï¼ˆä¾‹: `a1b2c3d4...`ï¼‰
- **Model name**ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å: `gpt-5.1-chat`ï¼‰
- **API version**ï¼ˆä¾‹: `2024-02-15-preview`ï¼‰

ã“ã‚Œã‚‰4ã¤ã®æƒ…å ±ã¯å¾Œã»ã©å¿…è¦ã«ãªã‚Šã¾ã™ã€‚

---

## Step 3: ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œç¢ºèª

ã“ã“ã‹ã‚‰ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã€ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

### 3-1. Flask ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…

ã“ã“ã‹ã‚‰ã¯**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆFlaskï¼‰**ã‚’ä»•ä¸Šã’ã¾ã™ã€‚æ§‹æˆã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ãŒã€å½¹å‰²ã‚’ã¯ã£ãã‚Šåˆ†ã‘ã‚‹ã¨åˆå¿ƒè€…ã§ã‚‚è¿½ã„ã‚„ã™ããªã‚Šã¾ã™ã€‚

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | å½¹å‰² | ä»£è¡¨ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | å¤±æ•—ã—ãŸã¨ãã«èµ·ã“ã‚‹ã“ã¨ |
|----------|------|------------------------|--------------------------|
| ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° (`/`, `/summarize` ãªã©) | ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€å‡¦ç†ã‚’æŒ¯ã‚Šåˆ†ã‘ã‚‹ | Flask (`from flask import ...`) | URL ãŒ 404 ã«ãªã‚‹ã€JSON ãŒè¿”ã‚‰ãªã„ |
| LLM å‘¼ã³å‡ºã— | Azure OpenAI ã«è¦ç´„ç”Ÿæˆã‚’ä¾é ¼ | `AzureChatOpenAI`, `ChatPromptTemplate` | API ã‚­ãƒ¼/ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒé–“é•ã£ã¦ã„ã‚‹ã¨ 401/404 |
| Mermaid æŠ½å‡º/å¤‰æ› | è¦ç´„çµæœã‹ã‚‰ ```mermaid``` ã‚’æŠœãå‡ºã— PNG å¤‰æ› | `re` / `subprocess` / `tempfile` | Mermaid ãŒè¦‹ã¤ã‹ã‚‰ãªã„ or mmdc å®Ÿè¡Œã«å¤±æ•— |
| å‡ºåŠ›æ•´å½¢ | Markdown/PNG ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¿”ã™ | `send_file`, `BytesIO` | ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ãŒå‹•ã‹ãªã„ |

ã“ã†ã—ã¦è²¬å‹™ã‚’åˆ‡ã£ã¦ãŠãã¨ã€ã€Œã©ã“ã§æ­¢ã¾ã£ã¦ã„ã‚‹ã®ã‹ã€ã‚’ãƒ­ã‚°ã‚„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰é€†ç®—ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚ã§ã¯å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

`main.py`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä½œæˆã—ã¾ã™ã€‚

```python
from flask import Flask, render_template, request, jsonify, send_file
from langchain_openai.chat_models import AzureChatOpenAI
from langchain_core.prompts import SystemMessagePromptTemplate
from langchain_core.prompts.chat import ChatPromptTemplate
import os
import re
import subprocess
import tempfile
from io import BytesIO
from dotenv import load_dotenv

load_dotenv()
DEVELOPMENT = os.getenv("DEVELOPMENT")
API_VERSION = os.getenv("API_VERSION")
ENDPOINT = os.getenv("ENDPOINT")
SUBSCRIPTION_KEY = os.getenv("SUBSCRIPTION_KEY")
MODEL_NAME = os.getenv("MODEL_NAME")


app = Flask(__name__)


@app.route('/')
def index():
    return render_template('index.html')


@app.route('/summarize', methods=['POST'])
def summarize():
    try:
        data = request.json
        news_text = data.get('news_text', '')

        if not news_text:
            return jsonify({'error': 'ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'}), 400

        model = AzureChatOpenAI(
            api_version=API_VERSION,
            azure_endpoint=ENDPOINT,
            api_key=SUBSCRIPTION_KEY,
            model_name=MODEL_NAME
        )

        template = """ä»¥ä¸‹ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹ã‚’è¦ç´„ã—ã¦ãã ã•ã„ã€‚è¦ç´„ã¯Markdownå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
            è¦ç´„ã«ã¯ä»¥ä¸‹ã®è¦ç´ ã‚’å«ã‚ã¦ãã ã•ã„ï¼š
            - ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆè¦‹å‡ºã—1ï¼‰
            - è¦ç‚¹ï¼ˆç®‡æ¡æ›¸ãï¼‰
            - è©³ç´°ãªè¦ç´„ï¼ˆæ®µè½å½¢å¼ï¼‰
            - mermaidã§è¨˜äº‹ã®å†…å®¹ã‚’å›³è§£

            ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹ï¼š
            {news_text}"""

        system_prompt = SystemMessagePromptTemplate.from_template(template)
        chain_prompt = ChatPromptTemplate.from_messages([system_prompt])

        chain = chain_prompt | model

        result = chain.invoke({"news_text": news_text})

        summary = result.content

        return jsonify({'summary': summary})

    except Exception as e:
        return jsonify({'error': f'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}'}), 500


@app.route('/download', methods=['POST'])
def download():
    try:
        data = request.json
        summary = data.get('summary', '')

        if not summary:
            return jsonify({'error': 'è¦ç´„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'}), 400

        # Markdownãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        buffer = BytesIO()
        buffer.write(summary.encode('utf-8'))
        buffer.seek(0)

        return send_file(
            buffer,
            as_attachment=True,
            download_name='news_summary.md',
            mimetype='text/markdown'
        )

    except Exception as e:
        return jsonify({'error': f'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}'}), 500


@app.route('/extract-mermaid', methods=['POST'])
def extract_mermaid():
    try:
        data = request.json
        summary = data.get('summary', '')

        if not summary:
            return jsonify({'error': 'è¦ç´„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'}), 400

        # Markdownã‹ã‚‰mermaidã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’æŠ½å‡º
        mermaid_pattern = r'```mermaid\n(.*?)\n```'
        matches = re.findall(mermaid_pattern, summary, re.DOTALL)

        if not matches:
            return jsonify({'error': 'mermaidå›³è§£ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'}), 400

        return jsonify({'mermaid_diagrams': matches, 'count': len(matches)})

    except Exception as e:
        return jsonify({'error': f'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}'}), 500


@app.route('/convert-mermaid-png', methods=['POST'])
def convert_mermaid_png():
    """
    Mermaidã‚³ãƒ¼ãƒ‰ã‚’ PNG ã«å¤‰æ›
    â€» Azure App Service ã§ã¯ mmdc ãŒåˆ©ç”¨ã§ããªã„ãŸã‚ã€ãƒ–ãƒ©ã‚¦ã‚¶å´ã§å‡¦ç†ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨
    """
    try:
        import shutil

        data = request.json
        mermaid_code = data.get('mermaid_code', '')
        diagram_index = data.get('diagram_index', 0)

        if not mermaid_code:
            return jsonify({'error': 'mermaidã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'}), 400

        # mmdc ã‚³ãƒãƒ³ãƒ‰ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
        mmdc_path = shutil.which('mmdc')
        if not mmdc_path:
            return jsonify({
                'error': 'Mermaid CLI ãŒã“ã®ç’°å¢ƒã§ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™ã€‚',
                'available_on_local': True,
                'mermaid_code': mermaid_code
            }), 501  # Not Implemented

        # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
        with tempfile.NamedTemporaryFile(mode='w', suffix='.mmd', delete=False) as f:
            f.write(mermaid_code)
            mmd_file = f.name

        try:
            # mmdc (mermaid-cli) ã‚’ä½¿ç”¨ã—ã¦PNGã«å¤‰æ›
            png_file = mmd_file.replace('.mmd', '.png')
            subprocess.run(
                ['mmdc', '-i', mmd_file, '-o', png_file, '-s', '2'],
                check=True,
                capture_output=True,
                timeout=30
            )

            # PNGãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãƒã‚¤ãƒŠãƒªã§è¿”ã™
            with open(png_file, 'rb') as f:
                png_data = f.read()

            buffer = BytesIO(png_data)
            buffer.seek(0)

            return send_file(
                buffer,
                mimetype='image/png',
                as_attachment=True,
                download_name=f'diagram_{diagram_index + 1}.png'
            )

        finally:
            # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
            if os.path.exists(mmd_file):
                os.remove(mmd_file)
            if os.path.exists(png_file):
                os.remove(png_file)

    except subprocess.CalledProcessError as e:
        return jsonify({'error': f'mermaidå¤‰æ›ã‚¨ãƒ©ãƒ¼: {e.stderr.decode() if e.stderr else str(e)}'}), 500
    except Exception as e:
        return jsonify({'error': f'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}'}), 500


if __name__ == '__main__':
    import sys
    # Azure App Service ã§ã®å®Ÿè¡Œã«å¯¾å¿œ
    port = int(os.environ.get('PORT', 5000))
    debug_mode = os.environ.get('FLASK_ENV') == 'development'
    app.run(host='0.0.0.0', port=port, debug=debug_mode)
```

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆã¨æ„å›³

- **`load_dotenv()` ã§ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€ç†ç”±**: APIã‚­ãƒ¼ã‚„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ã‚³ãƒ¼ãƒ‰ã«ç›´æ›¸ãã™ã‚‹ã¨ã€GitHubã«pushã—ãŸç¬é–“ã«æ¼ãˆã„ã—ã¾ã™ã€‚`.env`+`.gitignore`ã®çµ„ã¿åˆã‚ã›ã¯åˆå¿ƒè€…ã§ã‚‚å†åˆ©ç”¨ã—ã‚„ã™ã„ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãªã®ã§ã€å¿…ãšå†’é ­ã§èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚
- **`AzureChatOpenAI` ã®æ¡ç”¨**: LangChainã®Azureå‘ã‘ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ä½¿ã†ã“ã¨ã§ `api_version` ã‚„ `azure_endpoint` ã‚’éƒ½åº¦æŒ‡å®šã§ãã¾ã™ã€‚ç´ ã® `openai` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã‚ˆã‚Šè¨­å®šå¿˜ã‚ŒãŒèµ·ãã«ããã€è¨­å®šæ¼ã‚ŒãŒã‚ã‚‹ã¨ 401/404 ã§å³ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ç‚¹ã‚‚ç†è§£ã—ã‚„ã™ã„ã§ã™ã€‚
- **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå›ºå®šã®é‡è¦æ€§**: `SystemMessagePromptTemplate` ã§ Markdown å‡ºåŠ›ã‚’å¼·åˆ¶ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’å…¥ã‚Œãªã„ã¨ã€LLM ãŒè¦‹å‡ºã—ã‚„ç®‡æ¡æ›¸ãã‚’è¿”ã•ãšã€ãƒ•ãƒ­ãƒ³ãƒˆå´ã® Markdown ãƒ‘ãƒ¼ã‚µãƒ¼ãŒå´©ã‚Œã¾ã™ã€‚
- **Mermaid æŠ½å‡º/å¤‰æ›ã®äºŒæ®µæ§‹æˆ**: `/extract-mermaid` ã§æ­£è¦è¡¨ç¾ã«ã‚ˆã‚Š ```mermaid``` ãƒ–ãƒ­ãƒƒã‚¯ã®ã¿ã‚’æŠ½å‡ºã—ã€`/convert-mermaid-png` ã§PNGåŒ–ã—ã¦ã„ã¾ã™ã€‚1æœ¬ã®APIã§åŒæ™‚ã«ã‚„ã‚‹ã¨ã€å›³è§£ç”Ÿæˆã«å¤±æ•—ã—ãŸã ã‘ã§è¦ç´„å…¨ä½“ã¾ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¦ã—ã¾ã†ãŸã‚ã§ã™ã€‚
- **`shutil.which('mmdc')` ãƒã‚§ãƒƒã‚¯**: Azure App Service ã§ã¯ `mmdc` ãŒå…¥ã£ã¦ã„ãªã„ã“ã¨ãŒå¤šã„ã®ã§ã€åˆ©ç”¨å¯èƒ½ã‹ã‚’æœ€åˆã«åˆ¤å®šã—ã€ãªã‘ã‚Œã° 501 ã‚’è¿”ã—ã¦ã€Œãƒ­ãƒ¼ã‚«ãƒ«ã§å¤‰æ›ã—ã¦ã­ã€ã¨ä¼ãˆã¦ã„ã¾ã™ã€‚å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã‚’ã—ãªã„ã¨ã€å­˜åœ¨ã—ãªã„ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãç¶šã‘ã¦ã‚¢ãƒ—ãƒªå…¨ä½“ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚
- **`host='0.0.0.0'` ã¨ãƒãƒ¼ãƒˆã®å¤–ã ã—**: ãƒ­ãƒ¼ã‚«ãƒ«ãªã‚‰ `localhost` å›ºå®šã§ã‚‚å‹•ãã¾ã™ãŒã€ã‚¯ãƒ©ã‚¦ãƒ‰ã§ã¯å¤–éƒ¨ã‹ã‚‰æ¥ç¶šã§ããªããªã‚Šã¾ã™ã€‚`PORT` ã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã‚€ã‚ˆã†ã«ã—ãªã„ã¨ã€App Service ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒé€šã‚‰ãšãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—ã«ãªã‚‹ç‚¹ã‚‚ã‚»ãƒƒãƒˆã§è¦šãˆã¦ãŠãã¾ã—ã‚‡ã†ã€‚

#### ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ `app.py`

Azure App Service ã¯ãƒªãƒã‚¸ãƒˆãƒªç›´ä¸‹ã«ã‚ã‚‹ WSGI ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’æ¢ã—ã«æ¥ã‚‹ãŸã‚ã€`main.py` ã¨ã¯åˆ¥ã«è–„ã„ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã„ã¦ãŠãã¾ã™ã€‚

```python
"""
WSGI entry point for Azure App Service
"""
from main import app

if __name__ == '__main__':
    app.run()
```

- **å½¹å‰²**: `main.py` ã§å®šç¾©ã—ãŸ `app` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ Azure å´ã«å…¬é–‹ã™ã‚‹ã ã‘ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚App Service ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¹ã¯ `app:app` ã‚’æœŸå¾…ã™ã‚‹ã®ã§ã€åå‰ã‚’åˆã‚ã›ã‚‹ã¨è¿½åŠ è¨­å®šãªã—ã§èª­ã¿è¾¼ã‚“ã§ãã‚Œã¾ã™ã€‚
- **ãªãœåˆ†ã‘ã‚‹ã®ã‹**: `main.py` ã§ `if __name__ == '__main__'` ä»¥ä¸‹ã«ãƒ‡ãƒãƒƒã‚°ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚’æ›¸ã„ã¦ã„ã‚‹ãŸã‚ã€ãã®ã¾ã¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã¨å‰¯ä½œç”¨ï¼ˆãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œï¼‰ãŒèµ°ã‚Šã¾ã™ã€‚`app.py` ã‚’ç”¨æ„ã—ã¦ãŠãã¨ã€æœ¬ç•ªç’°å¢ƒã§ã¯ `gunicorn app:app` ã®ã‚ˆã†ã«å®‰å…¨ã«å‚ç…§ã§ãã¾ã™ã€‚
- **ç½®ã‹ãªã„ã¨ã©ã†ãªã‚‹ã‹**: App Service ãŒ Flask ã‚¢ãƒ—ãƒªã‚’è¦‹ã¤ã‘ã‚‰ã‚Œãšã€`Your app service is up, but your app is not responding` ã¨ã„ã£ãŸ 500 ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚`startup command` ã§æ˜ç¤ºçš„ã« `gunicorn wsgi:app` ã‚’æŒ‡å®šã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ãŒã€`app.py` ã‚’1æšç½®ãæ–¹ãŒåˆå¿ƒè€…ã«ã¯åˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚

### 3-2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆHTML/CSS/JavaScriptï¼‰ã‚’å®Ÿè£…

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒç”¨æ„ã§ããŸã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè§¦ã‚Œã‚‹ç”»é¢ã‚’ä½œã‚Šã¾ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ä»¥ä¸‹ã®3ãƒ•ã‚¡ã‚¤ãƒ«ã®é€£æºã§ã™ã€‚

| ãƒ•ã‚¡ã‚¤ãƒ« | å½¹å‰² | æ³¨ç›®ãƒã‚¤ãƒ³ãƒˆ |
|----------|------|--------------|
| `templates/index.html` | UI ã®éª¨æ ¼ã‚’å®šç¾©ã€‚Flask ã® `render_template` ã‹ã‚‰é…ä¿¡ | `textarea` ã¨çµæœãƒ‘ãƒãƒ«ã‚’2ã‚«ãƒ©ãƒ ã«åˆ†ã‘ã€ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã¯ã™ã¹ã¦ JS ã«ä»»ã›ã‚‹ |
| `static/styles.css` | ã‚¬ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ é¢¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ã§è¦–èªæ€§ã‚’æ‹…ä¿ | `@media` ã‚¯ã‚¨ãƒªã§ã‚¹ãƒãƒ›ã«ã‚‚å¯¾å¿œã€Markdown è¡¨ç¤ºéƒ¨åˆ†ã®ä½™ç™½èª¿æ•´ |
| `static/main.js` | API å‘¼ã³å‡ºã—ã€Markdown æç”»ã€Mermaid æŠ½å‡º/å¤‰æ›ãƒœã‚¿ãƒ³ | `fetch` + JSON ã§ Flask ãƒ«ãƒ¼ãƒˆã¨é€šä¿¡ã€`marked` ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ Markdown ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° |

ã€Œãƒ‡ãƒ¼ã‚¿ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã€è¡¨ç¤ºã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã€ã¨å‰²ã‚Šåˆ‡ã‚Šã€ãƒ•ã‚©ãƒ¼ãƒ ã® `action` ã‚’ä½¿ã‚ãšã™ã¹ã¦ JavaScript ã‹ã‚‰ API ã‚’å©ãè¨­è¨ˆã«ã—ã¦ã„ã‚‹ç‚¹ãŒè‚ã§ã™ã€‚

#### HTML: `templates/index.html`

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‹ãƒ¥ãƒ¼ã‚¹è¦ç´„ã‚¢ãƒ—ãƒª</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <h1>ğŸ“° ãƒ‹ãƒ¥ãƒ¼ã‚¹è¦ç´„ã‚¢ãƒ—ãƒª</h1>

        <div class="main-content">
            <!-- å…¥åŠ›ãƒ‘ãƒãƒ« -->
            <div class="panel">
                <h2>ãƒ‹ãƒ¥ãƒ¼ã‚¹æœ¬æ–‡ã‚’å…¥åŠ›</h2>
                <textarea id="newsInput"
                    placeholder="ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å…¨æ–‡ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."></textarea>
                <div class="button-group">
                    <button class="btn-primary" id="summarizeBtn" onclick="summarize()">
                        è¦ç´„ã™ã‚‹
                    </button>
                </div>
            </div>

            <!-- å‡ºåŠ›ãƒ‘ãƒãƒ« -->
            <div class="panel">
                <h2>è¦ç´„çµæœ</h2>
                <div id="summaryOutput">
                    <div class="placeholder">è¦ç´„çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
                </div>
                <div class="button-group">
                    <button class="btn-secondary" id="downloadBtn"
                        onclick="downloadMarkdown()" disabled>
                        Markdownã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </button>
                    <button class="btn-secondary" id="downloadDiagramBtn"
                        onclick="showDiagramMenu()" disabled>
                        å›³ã‚’PNGã§ä¿å­˜
                    </button>
                </div>

                <!-- å›³è§£ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
                <div id="diagramMenu" style="display: none;">
                    <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 8px;">
                        å›³è§£ã‚’é¸æŠ:
                    </p>
                    <div id="diagramButtonsContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>
```

#### CSS: `static/styles.css`

```css
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
}

h1 {
    text-align: center;
    color: white;
    margin-bottom: 40px;
    font-size: 2.5em;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
}

h2 {
    color: white;
    margin-bottom: 15px;
    font-size: 1.3em;
}

.main-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
}

@media (max-width: 768px) {
    .main-content {
        grid-template-columns: 1fr;
    }
}

.panel {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    padding: 25px;
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

textarea {
    width: 100%;
    height: 300px;
    padding: 15px;
    border: none;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.9);
    font-family: 'Courier New', monospace;
    font-size: 14px;
    resize: vertical;
    line-height: 1.6;
}

textarea:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
}

.button-group {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

button {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    flex: 1;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    flex: 1;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.btn-secondary:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

#summaryOutput {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 8px;
    padding: 20px;
    max-height: 600px;
    overflow-y: auto;
    margin-bottom: 15px;
    color: #333;
    line-height: 1.8;
}

.placeholder {
    text-align: center;
    color: #999;
    padding: 40px 20px;
}

/* Markdown ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
#summaryOutput h1 {
    color: #333;
    text-shadow: none;
    margin-top: 20px;
    margin-bottom: 15px;
    border-bottom: 2px solid #667eea;
    padding-bottom: 10px;
}

#summaryOutput h2 {
    color: #444;
    margin-top: 15px;
    margin-bottom: 10px;
}

#summaryOutput ul,
#summaryOutput ol {
    margin-left: 20px;
    margin-bottom: 15px;
}

#summaryOutput li {
    margin-bottom: 8px;
}

#summaryOutput p {
    margin-bottom: 15px;
}

#summaryOutput code {
    background: #f5f5f5;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
}

#summaryOutput pre {
    background: #f5f5f5;
    padding: 15px;
    border-radius: 8px;
    overflow-x: auto;
    margin-bottom: 15px;
}

/* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}
```

#### JavaScript: `static/main.js`

```javascript
let currentSummary = '';

/**
 * è¦ç´„ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
 */
async function summarize() {
    const newsText = document.getElementById('newsInput').value.trim();

    if (!newsText) {
        alert('ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }

    const summarizeBtn = document.getElementById('summarizeBtn');
    summarizeBtn.disabled = true;
    summarizeBtn.innerHTML = '<span class="loading"></span> å‡¦ç†ä¸­...';

    try {
        const response = await fetch('/summarize', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ news_text: newsText })
        });

        const data = await response.json();

        if (response.ok) {
            currentSummary = data.summary;
            displaySummary(data.summary);

            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            document.getElementById('downloadBtn').disabled = false;
            document.getElementById('downloadDiagramBtn').disabled = false;
        } else {
            alert('ã‚¨ãƒ©ãƒ¼: ' + data.error);
        }
    } catch (error) {
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    } finally {
        summarizeBtn.disabled = false;
        summarizeBtn.innerHTML = 'è¦ç´„ã™ã‚‹';
    }
}

/**
 * è¦ç´„çµæœã‚’ç”»é¢ã«è¡¨ç¤º
 */
function displaySummary(summary) {
    const output = document.getElementById('summaryOutput');

    // Markdownã‚’ HTMLã«å¤‰æ›
    const htmlContent = marked.parse(summary);
    output.innerHTML = htmlContent;
}

/**
 * Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
 */
async function downloadMarkdown() {
    try {
        const response = await fetch('/download', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ summary: currentSummary })
        });

        if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'news_summary.md';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            a.remove();
        } else {
            alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    } catch (error) {
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
}

/**
 * å›³è§£ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
 */
async function showDiagramMenu() {
    try {
        const response = await fetch('/extract-mermaid', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ summary: currentSummary })
        });

        const data = await response.json();

        if (response.ok) {
            const menu = document.getElementById('diagramMenu');
            const container = document.getElementById('diagramButtonsContainer');

            container.innerHTML = '';

            data.mermaid_diagrams.forEach((diagram, index) => {
                const btn = document.createElement('button');
                btn.className = 'btn-secondary';
                btn.textContent = `å›³è§£ ${index + 1} ã‚’ PNG ã§ä¿å­˜`;
                btn.onclick = () => convertAndDownloadDiagram(diagram, index);
                container.appendChild(btn);
            });

            menu.style.display = 'block';
        } else {
            alert(data.error);
        }
    } catch (error) {
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
}

/**
 * Mermaidã‚³ãƒ¼ãƒ‰ã‚’ PNG ã«å¤‰æ›ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
 */
async function convertAndDownloadDiagram(mermaidCode, diagramIndex) {
    const btn = event.target;
    btn.disabled = true;
    btn.innerHTML = '<span class="loading"></span> å¤‰æ›ä¸­...';

    try {
        const response = await fetch('/convert-mermaid-png', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                mermaid_code: mermaidCode,
                diagram_index: diagramIndex
            })
        });

        if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `diagram_${diagramIndex + 1}.png`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            a.remove();
        } else {
            alert('å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    } catch (error) {
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    } finally {
        btn.disabled = false;
        btn.innerHTML = `å›³è§£ ${diagramIndex + 1} ã‚’ PNG ã§ä¿å­˜`;
    }
}
```

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆã¨æ„å›³

- **HTMLã§å…¥åŠ›/å‡ºåŠ›ãƒ‘ãƒãƒ«ã‚’åˆ†é›¢**: åŒã˜ç”»é¢ã«å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã¨è¦ç´„çµæœã‚’ä¸¦ã¹ã‚‹ã“ã¨ã§ã€ã€Œå…¥åŠ›â†’AIâ†’å‡ºåŠ›ã€ã®æµã‚ŒãŒè¦–è¦šçš„ã«è¿½ã„ã‚„ã™ããªã‚Šã¾ã™ã€‚ãƒšãƒ¼ã‚¸ã‚’åˆ†ã‘ã‚‹å®Ÿè£…ã ã¨çŠ¶æ…‹ç®¡ç†ãŒå¢—ãˆã€åˆå¿ƒè€…ã»ã© JavaScript å´ã®ãƒã‚°ã§è©°ã¾ã‚Šã‚„ã™ã„ã®ã§ã€ã“ã®æ§‹æˆã‚’å‹§ã‚ã¦ã„ã¾ã™ã€‚
- **`marked.js` ã®èª­ã¿è¾¼ã¿**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒ Markdown ã‚’è¿”ã™å‰æãªã®ã§ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ HTML ã¸å³å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’å…¥ã‚Œãªã„ã¨ `# è¦‹å‡ºã—` ã‚„ `- ç®‡æ¡æ›¸ã` ãŒãã®ã¾ã¾ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã«ãªã‚Šã€ã›ã£ã‹ãæ•´ãˆãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å½¢å¼ãŒå´©ã‚Œã¾ã™ã€‚
- **CSS ã® `disabled`ï¼ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º**: API å‘¼ã³å‡ºã—ä¸­ã¯ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ãƒ»ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã€äºŒé‡é€ä¿¡ã‚’é˜²ã„ã§ã„ã¾ã™ã€‚ã“ã‚Œã‚’ã—ãªã„ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé€£æ‰“ã—ã¦ã—ã¾ã„ã€Azure OpenAI ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã§429ãŒè¿”ã£ã¦ã‚¢ãƒ—ãƒªãŒæ­¢ã¾ã‚Šã¾ã™ã€‚
- **`currentSummary` ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹**: æœ€æ–°ã®è¦ç´„ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ–ãƒ©ã‚¦ã‚¶å´ã«ä¿æŒã—ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚„å›³è§£æŠ½å‡ºæ™‚ã«ã‚µãƒ¼ãƒãƒ¼ã¸å†åº¦æœ¬æ–‡ã‚’é€ã‚‰ãªãã¦ã‚‚æ¸ˆã‚€ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã“ãŒç©ºã®ã¾ã¾ã ã¨ `/download` ã«ç©ºæ–‡å­—ã‚’é€ã£ã¦400ã‚¨ãƒ©ãƒ¼ã«ãªã‚ŠãŒã¡ã§ã™ã€‚
- **`fetch` + JSON ã§ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚’ JSON ã«æƒãˆã€`response.ok` ã‚’æ¯å›ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’çœç•¥ã™ã‚‹ã¨ 500 ã‚¨ãƒ©ãƒ¼ãŒåˆ©ç”¨è€…ã«ä¼ã‚ã‚‰ãšã€ã€Œã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ä½•ã‚‚èµ·ããªã„ã€ã¨ã„ã†å•ã„åˆã‚ã›ã«ã¤ãªãŒã‚Šã¾ã™ã€‚
- **Mermaid å›³è§£ã®ãƒœã‚¿ãƒ³ç”Ÿæˆ**: `/extract-mermaid` ã§è¿”ã£ãŸé…åˆ—ã‚’å‹•çš„ã«ãƒœã‚¿ãƒ³ã¸å¤‰æ›ã—ã€å¿…è¦ãªã¨ãã ã‘ `convert-mermaid-png` ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚ä¸€åº¦ã«å…¨å›³è§£ã‚’å¤‰æ›ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€1ã¤ã®ã‚¨ãƒ©ãƒ¼ã§å‡¦ç†å…¨ä½“ãŒæ­¢ã¾ã£ã¦ã—ã¾ã†ãŸã‚åˆ†å‰²ã—ã¦ã„ã¾ã™ã€‚

### 3-3. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€Azure OpenAIã®èªè¨¼æƒ…å ±ã‚’è¨­å®šã—ã¾ã™ã€‚

```bash
cat > .env << 'ENV'
# Azure OpenAI èªè¨¼æƒ…å ±
ENDPOINT=https://your-resource-name.openai.azure.com/
SUBSCRIPTION_KEY=your-api-key-here
MODEL_NAME=gpt-5.1-chat
API_VERSION=2024-02-15-preview

# é–‹ç™ºç’°å¢ƒãƒ•ãƒ©ã‚°
DEVELOPMENT=True
ENV
```

**å„å€¤ã®å–å¾—æ–¹æ³•ï¼š**

| é …ç›® | å–å¾—å ´æ‰€ |
|------|--------|
| **ENDPOINT** | Azure Portal â†’ Azure OpenAIãƒªã‚½ãƒ¼ã‚¹ â†’ ã‚­ãƒ¼ã¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ |
| **SUBSCRIPTION_KEY** | åŒä¸Š |
| **MODEL_NAME** | ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«æŒ‡å®šã—ãŸåå‰ï¼ˆä¾‹: `gpt-5.1-chat`ï¼‰ |
| **API_VERSION** | `2024-02-15-preview` ãªã©æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š |

**å‹•ä½œç¢ºèªã®ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ï¼š**

```bash
uv run python - <<'PY'
from dotenv import load_dotenv
import os
load_dotenv()
for key in ("ENDPOINT", "SUBSCRIPTION_KEY", "MODEL_NAME", "API_VERSION"):
    print(key, "=>", os.getenv(key))
PY
```

4ã¤ã™ã¹ã¦ã®å€¤ãŒè¡¨ç¤ºã•ã‚Œã‚Œã° `.env` ã®èª­ã¿è¾¼ã¿ã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚ç©ºæ¬„ãŒã‚ã‚‹å ´åˆã¯ã‚¹ãƒšãƒ«ãƒŸã‚¹ã‚„æ”¹è¡Œæ¼ã‚Œã‚’ç–‘ã£ã¦ãã ã•ã„ã€‚

### 3-4. ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œç¢ºèª

ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ãŸã‚‰ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¾ã™ã€‚

```bash
# ä»®æƒ³ç’°å¢ƒãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
(.venv) $

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•
python main.py
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š**
```
 * Serving Flask app 'main'
 * Debug mode: on
 * Running on http://127.0.0.1:5000
```

### 3-5. ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª

1. `http://localhost:5000` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ‹ãƒ¥ãƒ¼ã‚¹æœ¬æ–‡ã‚’å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã«è²¼ã‚Šä»˜ã‘
3. **ã€Œè¦ç´„ã™ã‚‹ã€**ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. è¦ç´„çµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

**ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ä¾‹ï¼š**
```
æ–°å‹AIãƒãƒƒãƒ—ãŒGoogleã‹ã‚‰ç™ºè¡¨ã•ã‚ŒãŸã€‚
ã“ã®ãƒãƒƒãƒ—ã¯å¾“æ¥æ¯”ã§10å€ã®å‡¦ç†é€Ÿåº¦ã‚’å®Ÿç¾ã™ã‚‹ã€‚
ä¾¡æ ¼ã¯999ãƒ‰ãƒ«ã‹ã‚‰äºˆå®šã•ã‚Œã¦ãŠã‚Šã€æ¥å¹´ä¸ŠåŠæœŸã«ä¸€èˆ¬å‘ã‘ãƒªãƒªãƒ¼ã‚¹äºˆå®šã€‚
æ¥­ç•Œã§ã¯å¤§ããªæ³¨ç›®ã‚’é›†ã‚ã¦ãŠã‚Šã€Microsoftã‚‚å¯¾æŠ—è£½å“ã®é–‹ç™ºã‚’é€²ã‚ã¦ã„ã‚‹ã¨ã®ã“ã¨ã€‚
```

---

## Step 4: GitHubã«ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®å‹•ä½œãŒç¢ºèªã§ããŸã‚‰ã€GitHubã«ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

### 4-1. GitHubã§æ–°è¦ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆ

1. [GitHub](https://github.com/)ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³
2. å³ä¸Šã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **Your repositories** â†’ **New** ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ä»¥ä¸‹ã‚’å…¥åŠ›ï¼š
   - **Repository name**: `news-summarizer-p`
   - **Description**: `AI-powered news summarization app with Azure OpenAI`
   - **Visibility**: `Public`ï¼ˆå…±æœ‰ç”¨ï¼‰or `Private`ï¼ˆéå…¬é–‹ï¼‰ã‚’é¸æŠ
   - **Initialize this repository with**: **ãƒã‚§ãƒƒã‚¯ã—ãªã„**ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å„ªå…ˆï¼‰
5. **Create repository** ã‚’ã‚¯ãƒªãƒƒã‚¯

### 4-2. GitHubãŒè¡¨ç¤ºã™ã‚‹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ

ãƒªãƒã‚¸ãƒˆãƒªä½œæˆå¾Œã€GitHubã®ç”»é¢ã«ä»¥ä¸‹ã®ã‚ˆã†ãªæ‰‹é †ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
â€¦or push an existing repository from the command line
```

ç”»é¢ã«è¡¨ç¤ºã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œã—ã¾ã™ï¼š

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã«ãƒªãƒ¢ãƒ¼ãƒˆ(GitHub)ã‚’è¨­å®š
git remote add origin https://github.com/[ãƒ¦ãƒ¼ã‚¶ãƒ¼å]/news-summarizer-p.git

# mainãƒ–ãƒ©ãƒ³ãƒã«ãƒªãƒãƒ¼ãƒ ï¼ˆå¿…è¦ãªå ´åˆï¼‰
git branch -M main

# æœ€åˆã®ã‚³ãƒŸãƒƒãƒˆã‚’ä½œæˆ
git add .
git commit -m "Initial commit: Add news summarizer application"

# GitHubã«ãƒ—ãƒƒã‚·ãƒ¥
git push -u origin main
```

**ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã®æµã‚Œï¼š**

1. `git add .` - ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°
2. `git commit -m "..."` - ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä»˜ãã§ã‚³ãƒŸãƒƒãƒˆ
3. `git push -u origin main` - GitHubã®mainãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥

**åˆå›å®Ÿè¡Œæ™‚ï¼š**

GitHubã®èªè¨¼ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã§å¯¾å¿œã—ã¦ãã ã•ã„ï¼š

**æ–¹æ³•A: Personal Access Token (ãƒˆãƒ¼ã‚¯ãƒ³èªè¨¼) - æ¨å¥¨**

1. GitHubã§ **Settings** â†’ **Developer settings** â†’ **Personal access tokens** ã‚’ã‚¯ãƒªãƒƒã‚¯
2. **Generate new token** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ä»¥ä¸‹ã‚’è¨­å®šï¼š
   - **Token name**: `git-cli`
   - **Expiration**: `90 days`
   - **Scopes**: `repo` (ã™ã¹ã¦ãƒã‚§ãƒƒã‚¯), `workflow` ã‚’ãƒã‚§ãƒƒã‚¯
4. **Generate token** ã‚’ã‚¯ãƒªãƒƒã‚¯
5. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆç”»é¢ã‚’é›¢ã‚Œã‚‹ã¨ã‚‚ã†è¦‹ãˆã¾ã›ã‚“ï¼‰
6. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ `git push` æ™‚ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’èã‹ã‚ŒãŸã‚‰ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒšãƒ¼ã‚¹ãƒˆ

**æ–¹æ³•B: SSHèªè¨¼**

```bash
# SSHéµã‚’ç”Ÿæˆï¼ˆã¾ã ãªã„å ´åˆï¼‰
ssh-keygen -t ed25519 -C "your@email.com"

# å…¬é–‹éµã‚’ã‚³ãƒ”ãƒ¼
cat ~/.ssh/id_ed25519.pub

# GitHubã«ã‚¢ã‚¯ã‚»ã‚¹ â†’ Settings â†’ SSH and GPG keys â†’ New SSH key
# ä¸Šè¨˜ã§ã‚³ãƒ”ãƒ¼ã—ãŸå†…å®¹ã‚’ãƒšãƒ¼ã‚¹ãƒˆ

# æ¬¡å›ã‹ã‚‰SSH URLã‚’ä½¿ç”¨
git remote set-url origin git@github.com:[ãƒ¦ãƒ¼ã‚¶ãƒ¼å]/news-summarizer-p.git
```

### 4-3. ãƒ—ãƒƒã‚·ãƒ¥ã®ç¢ºèª

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OKï¼š

```
Counting objects: 25, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (20/20), done.
Writing objects: 100% (25/25), 15.32 KiB | 3.06 MiB/s, done.
Total 25 (delta 0), reused 0 (delta 0), pack-reused 0
To https://github.com/[ãƒ¦ãƒ¼ã‚¶ãƒ¼å]/news-summarizer-p.git
 * [new branch]      main -> main
Branch 'main' set to track remote branch 'main' from 'origin'.
```

GitHubã®ç”»é¢ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€ã‚³ãƒ¼ãƒ‰ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

### 4-4. .envãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

**é‡è¦**: `.gitignore`ã«`.env`ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```bash
# .gitignore ã®å†…å®¹ã‚’ç¢ºèª
cat .gitignore | grep -i "\.env"

# å‡ºåŠ›ä¾‹:
# .env
# .env.local
```

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ãŒ`.gitignore`ã«å«ã¾ã‚Œã¦ã„ã‚Œã°ã€GitHubã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã›ã‚“ã€‚

ã‚‚ã—èª¤ã£ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã—ã¾ã£ãŸå ´åˆï¼š

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
git rm --cached .env

# .gitignore ã«è¿½åŠ 
echo ".env" >> .gitignore

# ã‚³ãƒŸãƒƒãƒˆ
git add .gitignore
git commit -m "Add .env to .gitignore"

# ãƒ—ãƒƒã‚·ãƒ¥
git push origin main
```

---

## Step 5: Azure App Serviceã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

GitHubã«ã‚³ãƒ¼ãƒ‰ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ããŸã‚‰ã€Azure App Serviceã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

### 5-1. Azure Portalã§App Serviceã‚’é–‹ã

1. [Azure Portal](https://portal.azure.com/)ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³
2. æ¤œç´¢ãƒãƒ¼ã§ `news-summarizer-app-[ID]` ã‚’æ¤œç´¢
3. ä½œæˆã—ãŸApp Serviceã‚’ã‚¯ãƒªãƒƒã‚¯

### 5-2. ãƒ‡ãƒ—ãƒ­ã‚¤ã‚»ãƒ³ã‚¿ãƒ¼ã‚’è¨­å®šï¼ˆGitHubé€£æºï¼‰

ã“ã“ã‹ã‚‰ã¯ã€GitHubãƒªãƒã‚¸ãƒˆãƒªã¨Azure App Serviceã‚’é€£æºã•ã›ã€è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¨­å®šã—ã¾ã™ã€‚

#### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ—ãƒ­ã‚¤ã‚»ãƒ³ã‚¿ãƒ¼ã‚’é–‹ã

1. [Azure Portal](https://portal.azure.com/)ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³
2. ä½œæˆã—ãŸ **App Service** ï¼ˆ`news-summarizer-app`ï¼‰ã‚’é–‹ã
3. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰**ãƒ‡ãƒ—ãƒ­ã‚¤ã‚»ãƒ³ã‚¿ãƒ¼**ã‚’é¸æŠ

#### ã‚¹ãƒ†ãƒƒãƒ—2: ã‚½ãƒ¼ã‚¹ã‚’ GitHub ã«è¨­å®š

1. **ã‚½ãƒ¼ã‚¹**ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ **GitHub** ã‚’é¸æŠ
2. **GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§èªå¯**ã‚’ã‚¯ãƒªãƒƒã‚¯
3. GitHubã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›

**âš ï¸ åˆå›ã®ã¿**: GitHubèªå¯ã‚’æ±‚ã‚ã‚‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
**Authorize AzureAppService** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¨±å¯ã—ã¦ãã ã•ã„ã€‚

#### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒªãƒã‚¸ãƒˆãƒªæƒ…å ±ã‚’è¨­å®š

èªå¯å¾Œã€ä»¥ä¸‹ã®é …ç›®ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãã‚Œãã‚Œã‚’è¨­å®šã—ã¾ã™ï¼š

| é …ç›® | å€¤ | èª¬æ˜ |
|------|-----|------|
| **çµ„ç¹”** | ã”è‡ªåˆ†ã®GitHubãƒ¦ãƒ¼ã‚¶ãƒ¼å | ä¾‹: `ken-kichi` |
| **ãƒªãƒã‚¸ãƒˆãƒª** | `news-summarizer-p` | Step 4ã§ä½œæˆã—ãŸãƒªãƒã‚¸ãƒˆãƒªå |
| **ãƒ–ãƒ©ãƒ³ãƒ** | `main` | ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãƒ–ãƒ©ãƒ³ãƒ |

**è¨­å®šä¾‹:**
- çµ„ç¹”: `ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå`
- ãƒªãƒã‚¸ãƒˆãƒª: `news-summarizer-p`
- ãƒ–ãƒ©ãƒ³ãƒ: `main`

#### ã‚¹ãƒ†ãƒƒãƒ—4: å¤‰æ›´ã‚’ä¿å­˜

ã™ã¹ã¦ã®è¨­å®šã‚’å…¥åŠ›ã—ãŸã‚‰ï¼š

1. ç”»é¢ä¸‹éƒ¨ã® **ä¿å­˜** ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ **OK** ã‚’ã‚¯ãƒªãƒƒã‚¯

**â³ åˆå›ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹**: æ•°åˆ†å¾…ã¤ã¨ã€è‡ªå‹•çš„ã«GitHubã‹ã‚‰ã‚³ãƒ¼ãƒ‰ãŒå–å¾—ã•ã‚Œã¦ã€ãƒ‡ãƒ—ãƒ­ã‚¤ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚

### 5-3. ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³ã®ç¢ºèª

#### ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Ÿè¡Œä¸­ã‹ç¢ºèª

1. **ãƒ‡ãƒ—ãƒ­ã‚¤ã‚»ãƒ³ã‚¿ãƒ¼** â†’ **ãƒ­ã‚°** ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ‡ãƒ—ãƒ­ã‚¤ã®é€²è¡ŒçŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç¢ºèª

**é€²è¡ŒçŠ¶æ³ã®è¡¨ç¤ºä¾‹ï¼š**
```
å—ä¿¡ä¸­...
å‡¦ç†ä¸­...
â³ ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ä¸­...
âœ… æˆåŠŸï¼ˆ2025-11-23 12:00:00ï¼‰
```

#### ãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—æ™‚ã®ç¢ºèª

ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¤±æ•—ã—ãŸå ´åˆï¼š

1. ãƒ­ã‚°å†…ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
2. **å‡ºåŠ›** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’ç¢ºèª
3. [Step 7: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#step-7-ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)ã‚’å‚ç…§

#### æˆåŠŸã®ç¢ºèªæ–¹æ³•

âœ… ãƒ‡ãƒ—ãƒ­ã‚¤ãŒæˆåŠŸã—ãŸã‚‰ã€ä»¥ä¸‹ã®ç¢ºèªã‚’ã—ã¦ãã ã•ã„ï¼š

```bash
# Azure CLIã§ App Service ã®ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ…‹ã‚’ç¢ºèª
az webapp deployment list-publishing-profiles \
  --resource-group news-summarizer-rg \
  --name news-summarizer-app

# ã¾ãŸã¯ã€App Service ãƒ­ã‚°ã‚’ç¢ºèª
az webapp log tail --resource-group news-summarizer-rg \
  --name news-summarizer-app
```

**æˆåŠŸã®ã‚µã‚¤ãƒ³:**
- âœ… ãƒ­ã‚°ã«ã€ŒBuild successfulã€ã¨è¡¨ç¤º
- âœ… é€²æ—çŠ¶æ³ãŒã€Œ100%ã€ã«
- âœ… ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€ŒActiveã€ã«å¤‰åŒ–

### 5-4. App Service ã«ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

**é‡è¦**: ãƒ­ãƒ¼ã‚«ãƒ«ã® `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨­å®šã—ãŸç’°å¢ƒå¤‰æ•°ã‚’ã€Azure App Service ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
App Service ã¯ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãŸã‚ã€Azure Portal ã§æ‰‹å‹•ã§è¨­å®šã—ã¾ã™ã€‚

#### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ­ãƒ¼ã‚«ãƒ«ã® .env ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’ç¢ºèª

ã¾ãšã€ãƒ­ãƒ¼ã‚«ãƒ«ã§è¨­å®šã—ãŸå€¤ã‚’ç¢ºèªã—ã¾ã™ï¼š

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã® .env ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’è¡¨ç¤º
cat .env
```

**å‡ºåŠ›ä¾‹ï¼š**
```
ENDPOINT=https://news-summarizer-openai.openai.azure.com/
SUBSCRIPTION_KEY=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
MODEL_NAME=gpt-5.1-chat
API_VERSION=2024-02-15-preview
```

ã“ã‚Œã‚‰ã®å€¤ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã¾ã™ã€‚

#### ã‚¹ãƒ†ãƒƒãƒ—2: Azure Portalã§è¨­å®š

1. [Azure Portal](https://portal.azure.com/)ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³
2. ä½œæˆã—ãŸ **App Service** ï¼ˆ`news-summarizer-app`ï¼‰ã‚’é–‹ã
3. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰**æ§‹æˆ**ã‚’é¸æŠ
4. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š**ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
5. **+ æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š**ã‚’ã‚¯ãƒªãƒƒã‚¯

#### ã‚¹ãƒ†ãƒƒãƒ—3: ç’°å¢ƒå¤‰æ•°ã‚’1ã¤ãšã¤è¿½åŠ 

ä»¥ä¸‹ã®4ã¤ã®å¤‰æ•°ã‚’ã™ã¹ã¦è¿½åŠ ã—ã¾ã™ï¼š

| å¤‰æ•°å | ãƒ­ãƒ¼ã‚«ãƒ« .env ã®å€¤ | ä¾‹ |
|--------|-----------------|-----|
| ENDPOINT | ENDPOINT ã®å€¤ | `https://news-summarizer-openai.openai.azure.com/` |
| SUBSCRIPTION_KEY | SUBSCRIPTION_KEY ã®å€¤ | `a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6` |
| MODEL_NAME | MODEL_NAME ã®å€¤ | `gpt-5.1-chat` |
| API_VERSION | API_VERSION ã®å€¤ | `2024-02-15-preview` |

> **ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³æ´¾ã®æ–¹ã¸**: Azure CLI ãŒä½¿ãˆã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ä¸€æ‹¬è¨­å®šã§ãã¾ã™ã€‚Portalã§ã®æ‰‹å…¥åŠ›ãƒŸã‚¹ã‚’æ¸›ã‚‰ã›ã‚‹ã®ã§ã€æ…£ã‚Œã¦ããŸã‚‰ã“ã¡ã‚‰ã‚‚æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚

```bash
az webapp config appsettings set \
  --resource-group news-summarizer-rg \
  --name news-summarizer-app \
  --settings \
    ENDPOINT=$(grep ENDPOINT .env | cut -d '=' -f2-) \
    SUBSCRIPTION_KEY=$(grep SUBSCRIPTION_KEY .env | cut -d '=' -f2-) \
    MODEL_NAME=$(grep MODEL_NAME .env | cut -d '=' -f2-) \
    API_VERSION=$(grep API_VERSION .env | cut -d '=' -f2-)
```

â€» macOS/Linux ç”¨ã®ä¾‹ã§ã™ã€‚PowerShell ã®å ´åˆã¯ `$env:ENDPOINT = (Get-Content .env | Select-String ...)` ãªã©ã€ãŠå¥½ã¿ã®ã‚„ã‚Šæ–¹ã§å€¤ã‚’æ¸¡ã—ã¦ãã ã•ã„ã€‚

**å„å¤‰æ•°ã®è¿½åŠ æ‰‹é †ï¼š**

1. **åå‰** ã«ä¸Šè¡¨ã®ã€Œå¤‰æ•°åã€ã‚’å…¥åŠ›
   - ä¾‹: `ENDPOINT`
2. **å€¤** ã«ãƒ­ãƒ¼ã‚«ãƒ«ã® `.env` ã‹ã‚‰å¯¾å¿œã™ã‚‹å€¤ã‚’ãƒšãƒ¼ã‚¹ãƒˆ
   - ä¾‹: `https://news-summarizer-openai.openai.azure.com/`
3. **OK** ã‚’ã‚¯ãƒªãƒƒã‚¯
4. æ¬¡ã®å¤‰æ•°ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ **+ æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š** ã‚’ã‚¯ãƒªãƒƒã‚¯

**âš ï¸ é‡è¦ãªæ³¨æ„ï¼š**

- **SUBSCRIPTION_KEYï¼ˆAPIã‚­ãƒ¼ï¼‰ã¯çµ¶å¯¾ã«ä»–äººã«å…±æœ‰ã—ãªã„ã§ãã ã•ã„**
- Gitã«ã‚³ãƒŸãƒƒãƒˆã—ãŸã‚Šã€å…¬é–‹ã®å ´æ‰€ã«ç½®ã‹ãªã„ã“ã¨
- Azure Portalã§ã®ã¿å®‰å…¨ã«ç®¡ç†ã•ã‚Œã¾ã™

#### ã‚¹ãƒ†ãƒƒãƒ—4: å¤‰æ›´ã‚’ä¿å­˜

ã™ã¹ã¦ã®ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ ã—ãŸã‚‰ï¼š

1. ç”»é¢ä¸Šéƒ¨ã® **ä¿å­˜** ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ **ç¶šè¡Œ** ã‚’ã‚¯ãƒªãƒƒã‚¯

**â³ å¤‰æ›´ãŒåæ˜ ã•ã‚Œã‚‹ã¾ã§æ•°åˆ†å¾…ã¡ã¾ã™**

#### ã‚¹ãƒ†ãƒƒãƒ—5: App Service ã‚’å†èµ·å‹•

ç’°å¢ƒå¤‰æ•°ãŒç¢ºå®Ÿã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã€App Service ã‚’å†èµ·å‹•ã—ã¾ã™ï¼š

```bash
# Azure CLI ã‚’ä½¿ç”¨ã—ãŸå†èµ·å‹•
az webapp restart \
  --resource-group news-summarizer-rg \
  --name news-summarizer-app
```

ã¾ãŸã¯ Azure Portal ã‹ã‚‰ï¼š

1. App Service ã®**æ¦‚è¦**ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ä¸Šéƒ¨ã® **å†èµ·å‹•** ã‚’ã‚¯ãƒªãƒƒã‚¯

ã“ã‚Œã§ã€Azure App Service ãŒãƒ­ãƒ¼ã‚«ãƒ«ã¨åŒã˜ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### 5-5. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹

1. App Serviceã®**æ¦‚è¦**ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
2. **URL**ã‚’ã‚³ãƒ”ãƒ¼
3. ãƒ–ãƒ©ã‚¦ã‚¶ã§ URLï¼ˆä¾‹: `https://news-summarizer-app.azurewebsites.net/`ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹

**ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ã‚¢ãƒ—ãƒªãŒAzureã§å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ï¼**

---

## Step 6: CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ§‹ç¯‰

ã“ã‚Œã‹ã‚‰ã¯ã€`main`ãƒ–ãƒ©ãƒ³ãƒã¸ã®pushã§è‡ªå‹•çš„ã«Azureã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

### 6-1. GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

Azure App Serviceã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚»ãƒ³ã‚¿ãƒ¼çµŒç”±ã§è‡ªå‹•ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒç”Ÿæˆã•ã‚Œã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ãŒã€ã“ã“ã§ã¯ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ‰‹å‹•ã§ä½œæˆã—ã¾ã™ã€‚

`.github/workflows/deploy.yaml` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š

```yaml
name: Build and deploy Python app to Azure Web App - news-summarizer-app

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python version
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install uv
        uses: astral-sh/setup-uv@v3

      - name: Install dependencies
        run: |
          uv venv antenv
          source antenv/bin/activate
          uv pip install -r requirements.txt
      - name: Upload artifact for deployment jobs
        uses: actions/upload-artifact@v4
        with:
          name: python-app
          path: |
            .
            !antenv/
  deploy:
    runs-on: ubuntu-latest
    needs: build
    permissions:
      id-token: write
      contents: read

    steps:
      - name: Download artifact from build job
        uses: actions/download-artifact@v4
        with:
          name: python-app

      - name: Login to Azure
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZUREAPPSERVICE_CLIENTID_28CB3E3328EB4E3896DD240927C792F2 }}
          tenant-id: ${{ secrets.AZUREAPPSERVICE_TENANTID_128BA5EC54904CA3AEFB0BC19A4F5C9A }}
          subscription-id: ${{ secrets.AZUREAPPSERVICE_SUBSCRIPTIONID_B9B2E02872414B8D9000CF6BCA4B8C1A }}

      - name: Wait for SCM stability
        run: sleep 30

      - name: Deploy to Azure Web App
        uses: azure/webapps-deploy@v3
        with:
          app-name: 'news-summarizer-app'
          slot-name: 'Production'

      - name: Wait for deployment completion
        run: sleep 20
```

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®èª¬æ˜ï¼š**

| ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|-----------|------|
| **on** | ãƒˆãƒªã‚¬ãƒ¼æ¡ä»¶ï¼ˆ`main`ã¸ã®pushæ™‚ã«å®Ÿè¡Œï¼‰ |
| **env** | ç’°å¢ƒå¤‰æ•°ã®å®šç¾©ï¼ˆAppåã‚„Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰ |
| **build** | ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–ï¼ˆä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨æ¤œè¨¼ï¼‰ |
| **deploy** | ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¸ãƒ§ãƒ–ï¼ˆAzureã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰ |

**ä¸»ãªæµã‚Œï¼š**

1. âœ… ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
2. âœ… Pythonç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
3. âœ… ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
4. âœ… ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆflake8ï¼‰
5. âœ… ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ä½œæˆ
6. âœ… Azureã¸ãƒ‡ãƒ—ãƒ­ã‚¤
7. âœ… ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ç¢ºèª

### 6-2. GitHub Secrets ã®è¨­å®š

GitHub Actions ãŒ Azure ã«èªè¨¼ã™ã‚‹ãŸã‚ã«ã€`AZURE_WEBAPP_PUBLISH_PROFILE` ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### ã‚¹ãƒ†ãƒƒãƒ—1: Azure Portal ã‹ã‚‰å…¬é–‹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—

1. [Azure Portal](https://portal.azure.com/) ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³
2. **App Service** ï¼ˆ`news-summarizer-app`ï¼‰ã‚’é–‹ã
3. ä¸Šéƒ¨ã® **å…¬é–‹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—** ã‚’ã‚¯ãƒªãƒƒã‚¯
4. XMLå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™

#### ã‚¹ãƒ†ãƒƒãƒ—2: GitHub Secrets ã«è¿½åŠ 

1. GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’é–‹ã
2. **Settings** â†’ **Secrets and variables** â†’ **Actions** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **New repository secret** ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ä»¥ä¸‹ã‚’å…¥åŠ›ï¼š
   - **Name**: `AZURE_WEBAPP_PUBLISH_PROFILE`
   - **Value**: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸXMLãƒ•ã‚¡ã‚¤ãƒ«ã®å…¨å†…å®¹ã‚’ãƒšãƒ¼ã‚¹ãƒˆ
5. **Add secret** ã‚’ã‚¯ãƒªãƒƒã‚¯

**âš ï¸ é‡è¦ãªæ³¨æ„ï¼š**
- ã“ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ã¯èªè¨¼æƒ…å ±ãŒå«ã¾ã‚Œã‚‹ãŸã‚ã€çµ¶å¯¾ã«å…¬é–‹ã—ãªã„ã“ã¨
- GitHub Secrets ã¯æš—å·åŒ–ã•ã‚Œã¦ä¿å­˜ã•ã‚Œã¾ã™

### 6-3. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ãƒ†ã‚¹ãƒˆ

ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ãƒ†ã‚¹ãƒˆï¼š

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆç”¨ã®å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
echo "# CI/CD Pipeline Test" >> README.md

# Gitã«è¿½åŠ 
git add README.md

# ã‚³ãƒŸãƒƒãƒˆ
git commit -m "Test CI/CD pipeline"

# GitHubã«ãƒ—ãƒƒã‚·ãƒ¥
git push origin main
```

### 6-4. ãƒ‡ãƒ—ãƒ­ã‚¤ã®è‡ªå‹•å®Ÿè¡Œã‚’ç¢ºèª

1. GitHubãƒªãƒã‚¸ãƒˆãƒªã® **Actions** ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
2. æ–°ã—ã„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡ŒãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆ`Build and deploy Python app...`ï¼‰
3. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’ç¢ºèª

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œç”»é¢ã®è¦‹æ–¹ï¼š**

```
âœ… build          (3-5åˆ†)
  â”œâ”€ Checkout code
  â”œâ”€ Set up Python
  â”œâ”€ Install dependencies
  â”œâ”€ Check Python syntax
  â””â”€ Upload artifact

âœ… deploy         (2-3åˆ†)
  â”œâ”€ Download artifact
  â”œâ”€ Deploy to Azure Web App
  â”œâ”€ Health check
  â””â”€ Deployment summary
```

**å„ã‚¹ãƒ†ãƒƒãƒ—ã®æ„å‘³ï¼š**

| ã‚¹ãƒ†ãƒƒãƒ— | çŠ¶æ…‹ | æ„å‘³ |
|---------|------|------|
| ğŸŸ¡ Running | å®Ÿè¡Œä¸­ | å‡¦ç†ä¸­ |
| âœ… Passed | æˆåŠŸ | æ­£å¸¸å®Œäº† |
| âŒ Failed | å¤±æ•— | ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ |
| â­ï¸ Skipped | ã‚¹ã‚­ãƒƒãƒ— | æ¡ä»¶ã«ã‚ˆã‚Šå®Ÿè¡Œã•ã‚Œãªã„ |

### 6-5. ãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—æ™‚ã®ç¢ºèª

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå¤±æ•—ã—ãŸå ´åˆï¼š

1. å¤±æ•—ã—ãŸã‚¸ãƒ§ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
2. èµ¤ã„ãƒãƒ„ãƒãƒ¼ã‚¯ã®ä»˜ã„ãŸã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¢ºèª
3. ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ­ã‚°ã‚’ç¢ºèª

**ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•ï¼š**

#### ã‚¨ãƒ©ãƒ¼: `Authentication failed`

**åŸå› **: `AZURE_WEBAPP_PUBLISH_PROFILE` ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```bash
# GitHub Secrets ã®è¨­å®šã‚’å†ç¢ºèª
# Settings â†’ Secrets and variables â†’ Actions ã‹ã‚‰ç¢ºèª
# XMLãƒ•ã‚¡ã‚¤ãƒ«ãŒå®Œå…¨ã«ãƒšãƒ¼ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
```

#### ã‚¨ãƒ©ãƒ¼: `uv pip install` ãŒå¤±æ•—ã™ã‚‹

**åŸå› **: `requirements.txt` ã«å•é¡ŒãŒã‚ã‚‹ã€ã¾ãŸã¯ uv ãŒä»®æƒ³ç’°å¢ƒã‚’æ­£ã—ãèªè­˜ã—ã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã§ä¾å­˜é–¢ä¿‚ã‚’ãƒ†ã‚¹ãƒˆ
uv pip install -r requirements.txt

# ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèª
cat requirements.txt
```

#### ã‚¨ãƒ©ãƒ¼: `Deployment timed out`

**åŸå› **: ãƒ‡ãƒ—ãƒ­ã‚¤ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•**:
- App Service ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—
- ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `.github/workflows/deploy.yaml` ã® `package` ã‹ã‚‰é™¤å¤–

### 6-6. ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã®ç¢ºèª

âœ… ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒæˆåŠŸã—ãŸã‚‰ï¼š

1. GitHubãƒªãƒã‚¸ãƒˆãƒªã® **Actions** ã‚¿ãƒ–ã§ âœ… ãƒãƒ¼ã‚¯ã‚’ç¢ºèª
2. Azure Portal ã§ App Service ã‚’é–‹ã
3. **æ¦‚è¦** ã‚¿ãƒ–ã® **URL** ã«ã‚¢ã‚¯ã‚»ã‚¹
4. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

**ãƒ‡ãƒ—ãƒ­ã‚¤ã®å®Œå…¨ãªæµã‚Œï¼š**

```
ã‚ãªãŸ: git push origin main
  â†“
GitHub: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é–‹å§‹ï¼ˆActionsï¼‰
  â”œâ”€ build ã‚¸ãƒ§ãƒ–å®Ÿè¡Œ
  â”‚  â”œâ”€ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  â”‚  â”œâ”€ ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
  â”‚  â””â”€ ãƒ“ãƒ«ãƒ‰æˆåŠŸ
  â”œâ”€ deploy ã‚¸ãƒ§ãƒ–å®Ÿè¡Œ
  â”‚  â”œâ”€ Azure ã«èªè¨¼
  â”‚  â”œâ”€ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  â”‚  â”œâ”€ App Service å†èµ·å‹•
  â”‚  â””â”€ ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†
  â†“
Azure App Service: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
  â†“
ãƒ¦ãƒ¼ã‚¶ãƒ¼: æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
```

### 6-7. GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç›£è¦–

å®šæœŸçš„ã«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŸã‚ã®æ–¹æ³•ï¼š

#### GitHub Notifications ã®è¨­å®š

1. GitHubã® **Settings** â†’ **Notifications** ã¸ç§»å‹•
2. **Actions** ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§é€šçŸ¥è¨­å®šã‚’ç¢ºèª
3. å¤±æ•—æ™‚ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’å—ã‘å–ã‚‹è¨­å®šãŒå¯èƒ½

#### Badge ã®è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

READMEã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ã‚’è¿½åŠ ï¼š

```markdown
# News Summarizer

[![Build and deploy Python app to Azure App Service](https://github.com/[ãƒ¦ãƒ¼ã‚¶ãƒ¼å]/news-summarizer-p/actions/workflows/deploy.yaml/badge.svg)](https://github.com/[ãƒ¦ãƒ¼ã‚¶ãƒ¼å]/news-summarizer-p/actions/workflows/deploy.yaml)

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã¾ã™ã€‚
```

**âœ… ã“ã‚Œä»¥é™ã€`main`ãƒ–ãƒ©ãƒ³ãƒã¸ã®pushã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚**

---

## Step 7: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ–¹æ³•ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

### Web App ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆ

**ç—‡çŠ¶**: Azure App Service ã® URL ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„

#### åŸå›  1: ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã‚³ãƒãƒ³ãƒ‰ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:

1. Azure Portal â†’ App Serviceï¼ˆ`news-summarizer-app`ï¼‰ã‚’é–‹ã
2. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ **æ§‹æˆ** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **ä¸€èˆ¬è¨­å®š** ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
4. **ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã‚³ãƒãƒ³ãƒ‰** ã«ä»¥ä¸‹ã‚’å…¥åŠ›ï¼š

```
gunicorn --bind 0.0.0.0:8000 --workers 4 --timeout 120 wsgi:app
```

5. **ä¿å­˜** ã‚’ã‚¯ãƒªãƒƒã‚¯
6. App Service ã‚’ **å†èµ·å‹•**

**å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ„å‘³**:
- `--bind 0.0.0.0:8000` : ã™ã¹ã¦ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ãƒãƒ¼ãƒˆ 8000 ã‚’ãƒªãƒƒã‚¹ãƒ³
- `--workers 4` : 4å€‹ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•
- `--timeout 120` : ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’120ç§’ã«è¨­å®š
- `wsgi:app` : WSGI ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ

#### åŸå›  2: ãƒ›ã‚¹ãƒˆãŒ `localhost` ã«é™å®šã•ã‚Œã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•**:

`main.py` ã¾ãŸã¯ `wsgi.py` ãŒä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š

```python
app.run(host='0.0.0.0', port=port)  # âœ… æ­£ã—ã„
# app.run(host='localhost', port=port)  # âŒ é–“é•ã„
```

æ—¢ã«ä¿®æ­£ã•ã‚Œã¦ã„ã¾ã™ã€‚

#### åŸå›  3: ãƒ­ã‚°ã‚’ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

**Azure ãƒãƒ¼ã‚¿ãƒ«ã§ãƒ­ã‚°ã‚’ç¢ºèª**:

1. Azure Portal â†’ App Service ã‚’é–‹ã
2. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ **ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ ** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ã‚’ç¢ºèª

**Azure CLI ã§ãƒ­ã‚°ã‚’ç¢ºèª**:

```bash
# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°è¡¨ç¤º
az webapp log tail --resource-group news-summarizer-rg --name news-summarizer-app

# ãƒ­ã‚°ã‚’ä¿å­˜ã—ã¦ç¢ºèª
az webapp log download --resource-group news-summarizer-rg \
  --name news-summarizer-app \
  --log-file app-logs.zip
```

#### åŸå›  4: ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„

**ç¢ºèªæ–¹æ³•**:

1. Azure Portal â†’ App Service â†’ **æ§‹æˆ**
2. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š** ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ä»¥ä¸‹ã®4ã¤ãŒå…¨ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼š
   - `ENDPOINT`
   - `SUBSCRIPTION_KEY`
   - `MODEL_NAME`
   - `API_VERSION`

**ã‚‚ã—ä¸è¶³ã—ã¦ã„ãŸã‚‰**:

1. **+ æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š** ã‚’ã‚¯ãƒªãƒƒã‚¯
2. å„å¤‰æ•°ã‚’è¿½åŠ 
3. **ä¿å­˜** ã‚’ã‚¯ãƒªãƒƒã‚¯
4. App Service ã‚’ **å†èµ·å‹•**

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã®ã‚¨ãƒ©ãƒ¼

#### Error 1: `mmdc: command not found`

**åŸå› **: Mermaid CLIãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```bash
npm install -g @mermaid-js/mermaid-cli
mmdc --version
```

#### Error 2: `Azure API error: InvalidAuthenticationTokenTenant`

**åŸå› **: Azure OpenAIã®èªè¨¼æƒ…å ±ãŒæ­£ã—ããªã„

**è§£æ±ºæ–¹æ³•**:
1. `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã® `ENDPOINT`, `SUBSCRIPTION_KEY` ã‚’ç¢ºèª
2. Azure Portalã§ã‚³ãƒ”ãƒ¼ã™ã‚‹ã¨ãURLã®æœ€å¾Œã« `/` ãŒä»˜ã„ã¦ã„ã‚‹ã‹ç¢ºèª
3. APIã‚­ãƒ¼ãŒæœŸé™åˆ‡ã‚Œã§ãªã„ã‹ç¢ºèª

#### Error 3: `No module named 'flask'`

**åŸå› **: å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```bash
uv pip install -r requirements.txt
```

#### Error 4: `Port 5000 is already in use`

**åŸå› **: ãƒãƒ¼ãƒˆ5000ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨

**è§£æ±ºæ–¹æ³•**:
```bash
# ä½¿ç”¨ä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèªï¼ˆmacOS/Linuxï¼‰
lsof -i :5000

# åˆ¥ã®ãƒãƒ¼ãƒˆã§èµ·å‹•
python main.py --port 5001
```

### GitHubãƒ—ãƒƒã‚·ãƒ¥æ™‚ã®ã‚¨ãƒ©ãƒ¼

#### Error 5: `fatal: remote origin already exists`

**åŸå› **: ã™ã§ã«ãƒªãƒ¢ãƒ¼ãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•**:
```bash
# æ—¢å­˜ã®ãƒªãƒ¢ãƒ¼ãƒˆã‚’ç¢ºèª
git remote -v

# æ–°ã—ã„ãƒªãƒ¢ãƒ¼ãƒˆã§ç½®ãæ›ãˆ
git remote set-url origin https://github.com/[ãƒ¦ãƒ¼ã‚¶ãƒ¼å]/news-summarizer-p.git
```

#### Error 6: `Authentication failed`

**åŸå› **: GitHubã®èªè¨¼æƒ…å ±ãŒæ­£ã—ããªã„

**è§£æ±ºæ–¹æ³•**:

æ–¹æ³•A: Personal Access Token ã‚’ä½¿ç”¨
```bash
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸèªè¨¼æƒ…å ±ã‚’ã‚¯ãƒªã‚¢
git credential reject
protocol=https
host=github.com

# å†åº¦ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›ï¼‰
git push origin main
```

æ–¹æ³•B: SSHèªè¨¼ã«å¤‰æ›´
```bash
git remote set-url origin git@github.com:[ãƒ¦ãƒ¼ã‚¶ãƒ¼å]/news-summarizer-p.git
git push origin main
```

### Azure ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ã‚¨ãƒ©ãƒ¼

#### Error 7: `Deployment failed: Missing requirements.txt`

**åŸå› **: `requirements.txt`ãŒGitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```bash
# requirements.txt ã‚’Gitã«è¿½åŠ 
git add requirements.txt
git commit -m "Add requirements.txt"
git push origin main
```

#### Error 8: `Application Insights: No module named 'flask'`

**åŸå› **: App Serviceä¸Šã§ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```bash
# App Service ã‚’å†èµ·å‹•
az webapp restart --resource-group news-summarizer-rg \
  --name news-summarizer-app
```

#### Error 9: Azure OpenAI API ã® 429 ã‚¨ãƒ©ãƒ¼ï¼ˆRate Limitï¼‰

**åŸå› **: APIå‘¼ã³å‡ºã—ã®åˆ¶é™ã‚’è¶…ãˆã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•**:
1. Azure OpenAIã®ãƒ‡ãƒ—ãƒ­ã‚¤TPMï¼ˆTokens Per Minuteï¼‰ã‚’å¢—åŠ 
2. App Service ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—
3. ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æ©Ÿèƒ½ã‚’å®Ÿè£…

#### Error 10: `Application did not respond within the time limit`

**åŸå› **: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•**:

1. **ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã‚³ãƒãƒ³ãƒ‰å†…ã§ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š**:

```bash
gunicorn --bind 0.0.0.0:8000 --workers 4 --timeout 300 wsgi:app
```

`--timeout 300` ã§ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’300ç§’ã«æ‹¡å¼µ

2. **App Service ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—**:
   - Azure Portal â†’ App Service ãƒ—ãƒ©ãƒ³
   - **ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—** ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ã‚ˆã‚Šå¤§ããªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆä¾‹: B1 ä»¥ä¸Šï¼‰ã‚’é¸æŠ

### ãƒ­ã‚°ã®ç¢ºèªæ–¹æ³•

#### ãƒ­ãƒ¼ã‚«ãƒ«ãƒ­ã‚°

```bash
# Flask ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’æœ‰åŠ¹åŒ–
FLASK_ENV=development FLASK_DEBUG=1 python main.py
```

#### Azure ãƒ­ã‚°

```bash
# App Service ã®ãƒ­ã‚°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
az webapp log tail --resource-group news-summarizer-rg \
  --name news-summarizer-app

# ã¾ãŸã¯ Kudu ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹
# URL: https://[app-name].scm.azurewebsites.net/
```

### ãƒ‡ãƒãƒƒã‚°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

Web App ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã€ä»¥ä¸‹ã‚’é †ç•ªã«ç¢ºèªã—ã¦ãã ã•ã„ï¼š

- [ ] **ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª**
  ```bash
  az webapp log tail --resource-group news-summarizer-rg --name news-summarizer-app
  ```

- [ ] **ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã‚³ãƒãƒ³ãƒ‰ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª**
  ```bash
  az webapp config show --resource-group news-summarizer-rg --name news-summarizer-app
  ```

- [ ] **ç’°å¢ƒå¤‰æ•°ãŒå…¨ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª**
  ```bash
  az webapp config appsettings list --resource-group news-summarizer-rg --name news-summarizer-app
  ```

- [ ] **requirements.txt ã«Flask ã¨ Gunicorn ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª**
  ```bash
  grep -E "Flask|gunicorn" requirements.txt
  ```

- [ ] **main.py ãŒ `host='0.0.0.0'` ã§èµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª**
  ```bash
  grep "host=" main.py
  ```

- [ ] **app.py ã¾ãŸã¯ wsgi.py ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª**
  ```bash
  ls -la app.py wsgi.py
  ```

- [ ] **GitHub Actions ãŒæˆåŠŸã—ãŸã‹ç¢ºèª**
  - GitHub â†’ Actions â†’ æœ€æ–°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ â†’ âœ… æˆåŠŸãƒãƒ¼ã‚¯

### Mermaid å›³è§£ã‚¨ãƒ©ãƒ¼ã®è§£æ±º

**ç—‡çŠ¶**: ã€ŒMermaid CLI ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹

#### åŸå› 

Azure App Service ç’°å¢ƒã§ã¯ `mmdc (mermaid-cli)` ã‚³ãƒãƒ³ãƒ‰ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŠã‚ˆã³ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ä¸Šã®ç†ç”±ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚

#### âœ… è§£æ±ºæ–¹æ³•

Mermaid å›³è§£æ©Ÿèƒ½ã¯ **3ã¤ã®æ–¹æ³•** ã§åˆ©ç”¨ã§ãã¾ã™ï¼š

##### æ–¹æ³• 1: ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å®Ÿè¡Œï¼ˆæœ€ã‚‚æ¨å¥¨ï¼‰

ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã™ã‚Œã°ã€å›³è§£ã® PNG å¤‰æ›ãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã™ã€‚

```bash
# ä»®æƒ³ç’°å¢ƒã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ
source .venv/bin/activate

# ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œ
python main.py

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:5000 ã«ã‚¢ã‚¯ã‚»ã‚¹
# â†’ Mermaid å›³è§£ã‚’ PNG ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½
```

##### æ–¹æ³• 2: Mermaid Live Editor ã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã€ŒMermaid Live Editorã€ã‚’ä½¿ç”¨ã—ã¦ã€å›³è§£ã‚’ PNG ã§ä¿å­˜ã§ãã¾ã™ã€‚

**æ‰‹é †**:
1. ã‚¢ãƒ—ãƒªã§è¦ç´„ã‚’ç”Ÿæˆ
2. ã€Œå›³ã‚’PNGã§ä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯: https://mermaid.live/
4. Mermaid ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ãƒšãƒ¼ã‚¹ãƒˆ
5. **Download** ãƒœã‚¿ãƒ³ã§ PNG ã‚’ä¿å­˜

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§å®Œçµ
- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸è¦
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«å›³ã‚’ç·¨é›†å¯èƒ½

##### æ–¹æ³• 3: Azure ã« npm ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆä¸Šç´šï¼‰

Azure App Service å†…ã« npm ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§ã€mmdc ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼ˆéæ¨å¥¨ï¼‰ã€‚

```bash
# Azure Kudu ã‚³ãƒ³ã‚½ãƒ¼ãƒ«çµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# https://[app-name].scm.azurewebsites.net/DebugConsole

npm install -g @mermaid-js/mermaid-cli
```

**æ³¨æ„**:
- âš ï¸ Azure ã®ç„¡æ–™æ ã§ã¯å®¹é‡åˆ¶é™ã«é”ã™ã‚‹å¯èƒ½æ€§
- âš ï¸ èµ·å‹•æ™‚é–“ãŒå¢—åŠ 
- âš ï¸ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä½ä¸‹ã™ã‚‹å¯èƒ½æ€§

#### æ¨å¥¨ãƒ•ãƒ­ãƒ¼

```
Azure Web App ã§ã®è¦ç´„ç”Ÿæˆ
    â†“
å›³è§£ã¨ã—ã¦ Mermaid ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
    â†“
ã€æ–¹æ³•1ã€‘ãƒ­ãƒ¼ã‚«ãƒ«ã§ PNG å¤‰æ› / ã€æ–¹æ³•2ã€‘Online Editor ã§å¤‰æ›
    â†“
PNG ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
```

---

## æœ€å¾Œã«

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€AIè¦ç´„ã‚¢ãƒ—ãƒªã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰Azureã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã€å®Œå…¨ã«æ§‹ç¯‰ã—ã¾ã—ãŸã€‚

### ç¿’å¾—ã—ãŸã‚¹ã‚­ãƒ«

âœ… Pythonä»®æƒ³ç’°å¢ƒã®æ§‹ç¯‰
âœ… Flask Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™º
âœ… Azure OpenAI API ã®çµ±åˆ
âœ… GitHub ã¸ã®ã‚³ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
âœ… Azure App Service ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
âœ… è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆCI/CDï¼‰ã®æ§‹ç¯‰
âœ… ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åŸºç¤

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã“ã®ã‚¢ãƒ—ãƒªã‚’ç™ºå±•ã•ã›ã‚‹ãªã‚‰ï¼š

1. **èªè¨¼æ©Ÿèƒ½ã®è¿½åŠ ** - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº** - è¦ç´„çµæœã®æ°¸ç¶šåŒ–ï¼ˆAzure Cosmos DBï¼‰
3. **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°** - å¤§è¦æ¨¡ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯å¯¾å¿œï¼ˆã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼‰
4. **ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ** - Application Insights ã§ã®ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
5. **APIã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤** - Azure API Management ã§ã®å…¬é–‹

### ã‚³ã‚¹ãƒˆæ¦‚ç®—

**åˆå¹´åº¦ã®æƒ³å®šè²»ç”¨:**

| ã‚µãƒ¼ãƒ“ã‚¹ | æœˆé¡ | å¹´é¡ |
|---------|------|------|
| App Service (Free) | Â¥0 | Â¥0 |
| Azure OpenAI (ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰) | Â¥3,000-5,000 | Â¥36,000-60,000 |
| GitHub (Personal) | Â¥0 | Â¥0 |
| **åˆè¨ˆ** | **Â¥3,000-5,000** | **Â¥36,000-60,000** |

**ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«**: Â¥22,500ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆï¼ˆ3ãƒ¶æœˆï¼‰

---

**æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼**

ã“ã®ã‚¢ãƒ—ãƒªãŒçš†ã•ã‚“ã®å­¦ç¿’ã®æ‰‹åŠ©ã‘ã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
ã‚¯ãƒ©ã‚¦ãƒ‰é–‹ç™ºã®ä¸–ç•Œã‚’ä¸€ç·’ã«æ¢æ±‚ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼
